<!DOCTYPE html>
<html>

<head>
  <title>Signup - Cafe27</title>
  <link rel="stylesheet" href="SingupStyle.css">

  <!-- Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script type="text/javascript">
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyB22ybnr73U6ya6i64Cxkknp8gyiwviNAo",
      authDomain: "cafe27-e5048.firebaseapp.com",
      databaseURL: "https://cafe27-e5048-default-rtdb.firebaseio.com",
      projectId: "cafe27-e5048",
      storageBucket: "cafe27-e5048.appspot.com",
      messagingSenderId: "806819987050",
      appId: "1:806819987050:web:f028aebbbb7a3ba69a5413",
      measurementId: "G-0CCLVWEG02"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();

    function signup() {
      const firstName = document.getElementById("AB").value.trim();
      const lastName = document.getElementById("CD").value.trim();
      const email = document.getElementById("EF").value.trim();
      const password = document.getElementById("GH").value;
      const confirmPassword = document.getElementById("IJ").value;
      const termsAccepted = document.getElementById("termsCheckbox").checked;

      if (firstName === "") {
        alert("Please enter the first name");
      } else if (lastName === "") {
        alert("Please enter the last name");
      } else if (email === "" || !email.endsWith("@gmail.com")) {
        alert("Please enter a valid Gmail address");
      } else if (password === "") {
        alert("Please enter the password");
      } else if (password.length < 8) {
        alert("Password should be at least 8 characters long");
      } else if (password !== confirmPassword) {
        alert("Passwords do not match");
      } else if (!termsAccepted) {
        alert("Please accept the Terms of Use & Privacy Policy");
      } else {
        auth.createUserWithEmailAndPassword(email, password)
          .then((userCredential) => {
            const user = userCredential.user;

            // Save user data under user.uid
            database.ref('users/' + user.uid).set({
              firstName: firstName,
              lastName: lastName,
              email: email
            }).then(() => {
              alert("Account created successfully!");
              window.location.href = "login.html"; // Redirect to login
            }).catch((error) => {
              console.error("Database write error: ", error);
              alert("Failed to save user data. Try again.");
            });
          })
          .catch((error) => {
            console.error("Signup error: ", error.message);
            alert("Error: " + error.message);
          });
      }
    }
  </script>
</head>

<body>
  <div class="header">
    <div class="heading1">
      <img class="logo" src="images/cagelogo.png" alt="Cafe27 Logo">
      <h1 class="title1">Cafe27</h1>
    </div>
    <h3 class="sub-header"><a href="Homepage.html">Home</a></h3>
    <h3><a href="login.html">Login</a></h3>
    <h3><a class="xyz" href="signup.html">Signup</a></h3>
  </div>

  <div class="bodyClass">
    <center>
      <div class="loginC">
        <form onsubmit="return false">
          <h1 class="title">SIGN UP</h1>
          <h4 class="title2">Please fill in this form to create an account</h4>

          <label class="label">First name:</label>
          <input type="text" class="textInput" placeholder="First name" id="AB"><br><br>

          <label class="label">Last name:</label>
          <input type="text" class="textInput" placeholder="Last name" id="CD"><br><br>

          <label class="label">Email:</label>
          <input type="email" class="textInput" placeholder="Email" id="EF"><br><br>

          <label class="label">Password:</label>
          <input type="password" class="textInput" placeholder="Password" id="GH"><br><br>

          <div class="inline-field">
            <label class="label">Confirm Password:</label>
            <input type="password" class="textInput" placeholder="Confirm Password" id="IJ">
          </div>
          <br><br>
          

          <input type="checkbox" id="termsCheckbox" class="checkbox" checked> I accept the Terms of use & Privacy Policy<br><br>

          <h4 class="message">Already have an account? <a href="login.html" class="loginLink">LOGIN HERE</a></h4>

          <input type="button" class="button" value="Sign up" onclick="signup()">
        </form>
      </div>
    </center>
  </div>

  <section class="Footer">
    <div class="border">
      <h3>#Let's_Talk</h3>
      <p>LEAVE A MESSAGE, We love to hear from you!</p><br><br>
    </div>
    <div class="contact">
      <p>Contact: 8600861264<br><br>Email: Cafe27@gmail.com</p>
      <p>Instagram: Cafe_System27<br><br>YouTube: Cafe Center 27</p>
    </div>
    <div class="form">
      <input type="text" placeholder="Leave Message">
      <button class="normal">Submit</button>
    </div>
  </section>
</body>

</html>
